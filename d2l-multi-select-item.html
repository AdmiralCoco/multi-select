<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">
<link rel="import" href="../d2l-typography/d2l-typography-shared-styles.html">
<link rel="import" href="../d2l-icons/d2l-icon.html">
<link rel="import" href="../d2l-icons/tier1-icons.html">
<link rel="import" href="localize-behavior.html">

<dom-module id="d2l-multi-select-item">
	<template strip-whitespace>
		<style>
			:host {
				cursor: pointer;
				display: inline-block;
				outline: none;
				position: relative;
			}

			.d2l-multi-select-item-wrapper {
				@apply --d2l-body-compact-text;
				-moz-user-select: none;
				-ms-user-select: none;
				-webkit-user-select: none;

				align-items: center;
				background-color: var(--d2l-color-sylvite);
				border: 1px solid var(--d2l-color-gypsum);
				border-radius: 0.25rem;
				cursor: pointer;
				display: flex;
				line-height: normal;
				outline: none;
				padding: 0.25rem 0.75rem 0.2rem;
			}

			:host([deletable]) .d2l-multi-select-item-wrapper {
				padding-right: 0.4rem;
			}

			:host([dir='rtl'][deletable]) .d2l-multi-select-item-wrapper {
				padding-left: 0.4rem;
				padding-right: 0.75rem;
			}

			:host(:hover) .d2l-multi-select-item-wrapper {
				background-color: var(--d2l-color-gypsum);
				border-color: var(--d2l-color-mica);
			}

			:host(:hover) .d2l-multi-select-item-wrapper d2l-icon:hover {
				color: var(--d2l-color-ferrite);
			}

			:host(:focus) .d2l-multi-select-item-wrapper,
			:host(:focus) .d2l-multi-select-item-wrapper d2l-icon {
				background-color: var(--d2l-color-celestine);
				border-color: var(--d2l-color-celestine-minus-1);
				color: #ffffff;
			}

			d2l-icon {
				--d2l-icon-height: 0.5rem;
				--d2l-icon-width: 0.5rem;
				color: var(--d2l-color-galena);
				cursor: pointer;
				padding: 0.2rem;
				margin-left: 0.15rem;
				vertical-align: middle;
			}

			d2l-icon[hidden] {
				display: none;
			}

			:host(:dir(rtl)) d2l-icon {
				margin-left: 0;
				margin-right: 0.15rem;
			}

		</style>

		<div class="d2l-multi-select-item-wrapper">
			<div class="d2l-multi-select-item-text">[[text]]</div>
			<d2l-icon icon="d2l-tier1:close-large-thick" hidden=[[!deletable]] on-click="_onDeleteClick" />
		</div>
	</template>
	<script>
		/**
		 * `<d2l-multi-select-item>`
		 * Polymer-based web component for D2L multi-select-item
		 * @demo demo/index.hmtl
		 */
		class D2LMultiSelectItem extends Polymer.mixinBehaviors(
			[D2L.PolymerBehaviors.D2LMultiSelect.LocalizeBehavior], Polymer.Element
		) {
			static get is() { return 'd2l-multi-select-item'; }
			static get properties() {
				return {
					/**
					 * Fired when the multi-select-item is deleted.
					 * @event d2l-multi-select-item-deleted
					*/

					/**
					* Text displayed in the multi-select-item.
					*/
					text: {
						type: String,
						value: ''
					},
					/**
					* Whether the multi-select-item can be deleted. False unless 'deletable' property is set.
					*/
					deletable: {
						type: Boolean,
						value: false
					},
				};
			}

			constructor() {
				super();
				this._keyCodes = { BACKSPACE: 8, DELETE: 46 };
			}

			ready() {
				super.ready();
			}

			connectedCallback() {
				super.connectedCallback();
				this.tabIndex = -1; // Set tabindex to allow focusable behaviour
				this.addEventListener('keydown', this._onKeyDown);
			}

			disconnectedCallback() {
				super.disconnectedCallback();
				this.removeEventListener('keydown', this._onKeyDown);
			}

			_onKeyDown(event) {
				if ((event.keyCode === this._keyCodes.BACKSPACE || event.keyCode === this._keyCodes.DELETE)
					&& this.deletable) {
					event.preventDefault();
					event.stopPropagation();
					this._onDeleteClick();
				}
			}

			_onDeleteClick() {
				this.dispatchEvent(new CustomEvent(
					'd2l-multi-select-item-deleted',
					{ bubbles: true, composed: true, detail: { value: this.text } }
				));
				this.parentNode.removeChild(this);
			}
		}
		customElements.define(D2LMultiSelectItem.is, D2LMultiSelectItem);
	</script>
</dom-module>
